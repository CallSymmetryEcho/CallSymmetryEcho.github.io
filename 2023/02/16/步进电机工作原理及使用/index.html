<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  <meta name="referrer" content="unsafe-url">
  
  <title>步进电机工作原理及使用,自动泡片机制作</title>
  <meta name="author" content="Jakie Lian">
  <meta name="description" content="良好的学习资源： Stepper
Motors and Arduino - The Ultimate Guide (howtomechatronics.com) How
Stepper Motors Work
认识步进驱动器 | 北岛夜话
(founderchip.com) 模拟工具推荐： http">
  
  
  <meta property="og:title" content="步进电机工作原理及使用,自动泡片机制作"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="无限进步"/>
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/atom.xml" title="无限进步" type="application/atom+xml">
  <link rel="stylesheet" href="/css/m.min.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <a id="top"></a>
  <div id="main">
    <div class="main-ctnr">
      <div class="behind">
  <a href="/" class="back black-color">
    <svg class="i-close" viewBox="0 0 32 32" width="22" height="22" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
        <path d="M2 30 L30 2 M30 30 L2 2"></path>
    </svg>
  </a>
  
</div>


  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        步进电机工作原理及使用,自动泡片机制作
    </h1>
  


    </div>
    <div class="meta center">
      <time datetime="2023-02-16T21:49:04.352Z" itemprop="datePublished">
  <svg class="i-calendar" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
    <path d="M2 6 L2 30 30 30 30 6 Z M2 15 L30 15 M7 3 L7 9 M13 3 L13 9 M19 3 L19 9 M25 3 L25 9"></path>
  </svg>
  &nbsp;
  2023-02-16
</time>





    
    &nbsp;
    <svg class="i-tag" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
      <circle cx="24" cy="8" r="2"></circle>
      <path d="M2 18 L18 2 30 2 30 14 14 30 Z"></path>
    </svg>
    &nbsp;
    <a href="/tags/ChatGPT/">ChatGPT</a>·<a href="/tags/AI-辅助学习/">AI 辅助学习</a>·<a href="/tags/Robotic-Proj/">Robotic Proj</a>


    </div>
    <hr>
    
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BB%A3%E7%A0%81%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="toc-text">自己的代码和实现的项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-text">步进电机的基本原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E4%B8%8D%E5%90%8Cdriver-%E7%9A%84%E6%8E%A5%E7%BA%BF"><span class="toc-text">步进电机不同driver 的接线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#auto-immersion-lifter%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-text">Auto-immersion-lifter的实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#aduino-code"><span class="toc-text">Aduino code:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pcb%E6%9D%BF%E6%8E%A7%E5%88%B6%E7%AB%AF%E7%BB%99%E5%87%BA%E4%B8%B2%E5%8F%A3%E7%94%B1python%E6%8E%A5%E7%AE%A1%E8%B0%83%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-text">PCB板控制端，给出串口，由python接管调用功能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution"><span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#what-is-a-stepper-motor-and-how-it-works"><span class="toc-text">What is a Stepper
Motor and How It Works?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#how-to-control-nema17-stepper-motor-with-arduino-and-a4988-stepper-driver"><span class="toc-text">How
To Control NEMA17 Stepper Motor with Arduino and A4988 Stepper
Driver</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a4988-and-arduino-connection"><span class="toc-text">A4988 and Arduino Connection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#a4988-current-limiting"><span class="toc-text">A4988 Current Limiting</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stepper-motors-and-arduino-example-codes"><span class="toc-text">Stepper Motors and
Arduino – Example Codes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#controlling-stepper-motors-with-arduino-and-the-accelstepper-library-examples"><span class="toc-text">Controlling
Stepper Motors with Arduino and the AccelStepper Library – Examples</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#example-code-stepper-motor-speed-control-using-a-potentiometer"><span class="toc-text">Example
code – Stepper motor speed control using a potentiometer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example-code-controlling-two-stepper-motors-with-acceleration-and-deceleration"><span class="toc-text">Example
code – Controlling two stepper motors with acceleration and
deceleration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#example-code-controlling-multiple-stepper-motors-with-accelstepper-library"><span class="toc-text">Example
code – Controlling multiple stepper motors with AccelStepper
library</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cnc-shield-for-controlling-multiple-stepper-motors-for-any-arduino-project"><span class="toc-text">CNC
shield for controlling multiple stepper motors for any Arduino
project</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#drv8825-vs-a4988"><span class="toc-text">DRV8825 vs A4988</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tmc2208-stepper-driver"><span class="toc-text">TMC2208 Stepper Driver</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E8%BF%9B%E9%A9%B1%E5%8A%A8%E5%99%A8%E7%9A%84%E6%8E%A5%E7%BA%BF%E5%8F%8A%E8%AE%BE%E7%BD%AE"><span class="toc-text">2、步进驱动器的接线及设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E7%9A%84%E7%94%B5%E6%B5%81%E8%AE%BE%E7%BD%AE"><span class="toc-text">2.4、步进电机的电流设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%86%E5%88%86%E9%A9%B1%E5%8A%A8%E8%AE%BE%E7%BD%AE"><span class="toc-text">3、细分驱动设置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#how-the-stepper-motor-work-%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">How the Stepper
Motor work 步进电机工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#working-principle"><span class="toc-text">Working Principle</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#working-principle-of-stepper-motor"><span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#driving-modes"><span class="toc-text">Driving Modes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stepper-motor-types-by-construction"><span class="toc-text">Stepper Motor Types by
Construction</span></a></li></ol>
    
    <div class="picture-container">
      
    </div>
    <p>良好的学习资源： <a
target="_blank" rel="noopener" href="https://howtomechatronics.com/tutorials/arduino/stepper-motors-and-arduino-the-ultimate-guide/">Stepper
Motors and Arduino - The Ultimate Guide (howtomechatronics.com)</a> <a
target="_blank" rel="noopener" href="https://howtomechatronics.com/how-it-works/electrical-engineering/stepper-motor/">How
Stepper Motors Work</a><br />
<a target="_blank" rel="noopener" href="https://www.founderchip.com/?id=264">认识步进驱动器 | 北岛夜话
(founderchip.com)</a> 模拟工具推荐： https://www.tinkercad.com/
本博客创建为学习这个网站的笔记，并且转载该博客内容</p>
<h2 id="自己的代码和实现的项目">自己的代码和实现的项目</h2>
<h3 id="步进电机的基本原理">步进电机的基本原理</h3>
<p>(参照 Dejan博客，收集与下文)</p>
<h3 id="步进电机不同driver-的接线">步进电机不同driver 的接线</h3>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/A4988-and-Arduino-Connection-Wiring-Diagram.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/A4988-and-Arduino-Connection-Wiring-Diagram-1024x501.png"
alt="A4988 and Arduino Connection - Wiring Diagram" /></a>
A4988driver</p>
<img src="/2023/02/16/%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BD%BF%E7%94%A8/Pasted%20image%2020230217014307.png" class="">
<p>TB6600</p>
<h3 id="auto-immersion-lifter的实现">Auto-immersion-lifter的实现</h3>
<h5 id="aduino-code">Aduino code:</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;AccelStepper.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">// Define the stepper motor and the pins that is connected to</span></span><br><span class="line"></span><br><span class="line">AccelStepper <span class="title function_">stepper1</span><span class="params">(<span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>)</span>; <span class="comment">// (Typeof driver: with 2 pins, STEP, DIR)</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">Serial.begin(<span class="number">9600</span>);</span><br><span class="line"></span><br><span class="line">stepper1.setMaxSpeed(<span class="number">1000</span>); <span class="comment">// Set maximum speed value for the stepper</span></span><br><span class="line"></span><br><span class="line">stepper1.setAcceleration(<span class="number">500</span>); <span class="comment">// Set acceleration value for the stepper</span></span><br><span class="line"></span><br><span class="line">stepper1.setCurrentPosition(<span class="number">0</span>); <span class="comment">// Set the current position to 0 steps</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Serial.available() &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">String incomingString = Serial.readStringUntil(<span class="string">&#x27;\n&#x27;</span>); <span class="comment">// Read until the &quot;Enter&quot; button is pressed</span></span><br><span class="line"></span><br><span class="line">incomingString.trim(); <span class="comment">// Remove leading/trailing whitespaces</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (incomingString == <span class="string">&quot;lift&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">Serial.println(<span class="string">&quot;Enter number of steps to move:&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!Serial.available()); <span class="comment">// Wait until a character is received</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> stepsToMove = Serial.parseInt(); <span class="comment">// Read an integer from the serial buffer</span></span><br><span class="line"></span><br><span class="line">Serial.print(<span class="string">&quot;Moving UP by &quot;</span>);</span><br><span class="line"></span><br><span class="line">Serial.print(stepsToMove);</span><br><span class="line"></span><br><span class="line">Serial.println(<span class="string">&quot; steps&quot;</span>);</span><br><span class="line"></span><br><span class="line">stepper1.moveTo(stepsToMove); <span class="comment">// Set desired move: stepsToMove steps</span></span><br><span class="line"></span><br><span class="line">stepper1.runToPosition(); <span class="comment">// Moves the motor to target position</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (incomingString == <span class="string">&quot;back&quot;</span>) &#123;</span><br><span class="line"></span><br><span class="line">Serial.println(<span class="string">&quot;Moving back to original position&quot;</span>);</span><br><span class="line"></span><br><span class="line">stepper1.moveTo(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">stepper1.runToPosition();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (incomingString == <span class="string">&quot;set0&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">stepper1.setCurrentPosition(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里需要提及的是：读取字符串的判断,第一版写法： <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Serial.available() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">   String incomingString = Serial.readString();</span><br><span class="line">   <span class="keyword">if</span> (incomingString == <span class="string">&quot;lift&quot;</span>) &#123;</span><br><span class="line">     Serial.println(<span class="string">&quot;Moving down 15000 steps&quot;</span>);</span><br><span class="line">     stepper1.moveTo(<span class="number">15000</span>); <span class="comment">// Set desired move: 15000 steps</span></span><br><span class="line">     stepper1.runToPosition(); <span class="comment">// Moves the motor to target position with acceleration/deceleration and blocks until it is in position</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
可以成功读取，但是无法满足判断条件，怀疑是一起读取了'enter'
''于是使用chatgpt 检查并确认,同时向Chatgpt
学习数字的读取使用Serial.parseInt()</p>
<p>Q:Could it be also because I type the "enter" botton and it be count
as part of the string?</p>
<blockquote>
<p>A :Yes, that could be the problem. When you type a string followed by
the "Enter" button, the "Enter" button is also sent as a character to
the serial buffer, which is then read by the
<code>Serial.readString()</code> function as part of the string.</p>
</blockquote>
<p>To solve this problem, you can use the
<code>Serial.readStringUntil()</code> function instead of
<code>Serial.readString()</code>. The
<code>Serial.readStringUntil()</code> function reads the serial buffer
until a specific character is encountered and then returns the received
string.</p>
<p>Here's the modified code that uses
<code>Serial.readStringUntil()</code> to read the input string until the
"Enter" button is pressed:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;AccelStepper.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define the stepper motor and the pins that is connected to</span></span><br><span class="line">AccelStepper <span class="title function_">stepper1</span><span class="params">(<span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>)</span>; <span class="comment">// (Typeof driver: with 2 pins, STEP, DIR)</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  stepper1.setMaxSpeed(<span class="number">1000</span>); <span class="comment">// Set maximum speed value for the stepper</span></span><br><span class="line">  stepper1.setAcceleration(<span class="number">500</span>); <span class="comment">// Set acceleration value for the stepper</span></span><br><span class="line">  stepper1.setCurrentPosition(<span class="number">0</span>); <span class="comment">// Set the current position to 0 steps</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (Serial.available() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    String incomingString = Serial.readStringUntil(<span class="string">&#x27;\n&#x27;</span>); <span class="comment">// Read until the &quot;Enter&quot; button is pressed</span></span><br><span class="line">    incomingString.trim(); <span class="comment">// Remove leading/trailing whitespaces</span></span><br><span class="line">    <span class="keyword">if</span> (incomingString == <span class="string">&quot;lift&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;Moving down&quot;</span>);</span><br><span class="line">      stepper1.moveTo(<span class="number">15000</span>); <span class="comment">// Set desired move: 15000 steps</span></span><br><span class="line">      stepper1.runToPosition(); <span class="comment">// Moves the motor to target position</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (incomingString == <span class="string">&quot;back&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;Moving back to original position&quot;</span>);</span><br><span class="line">      stepper1.moveTo(<span class="number">0</span>);</span><br><span class="line">      stepper1.runToPosition();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>The modified code reads the input string until the "Enter" button
(<code>\n</code> character) is pressed and then removes the
leading/trailing whitespaces using the <code>String.trim()</code>
function.</p>
<blockquote>
<p>Sure! To add a function that allows you to enter the moving steps
from Python, you can use the <code>Seri al.parseInt()</code> function to
read an integer value from the serial buffer.</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">scss<span class="meta">#<span class="keyword">include</span> <span class="string">&lt;AccelStepper.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define the stepper motor and the pins that is connected to</span></span><br><span class="line">AccelStepper <span class="title function_">stepper1</span><span class="params">(<span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>)</span>; <span class="comment">// (Typeof driver: with 2 pins, STEP, DIR)</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  stepper1.setMaxSpeed(<span class="number">1000</span>); <span class="comment">// Set maximum speed value for the stepper</span></span><br><span class="line">  stepper1.setAcceleration(<span class="number">500</span>); <span class="comment">// Set acceleration value for the stepper</span></span><br><span class="line">  stepper1.setCurrentPosition(<span class="number">0</span>); <span class="comment">// Set the current position to 0 steps</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (Serial.available() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    String incomingString = Serial.readStringUntil(<span class="string">&#x27;\n&#x27;</span>); <span class="comment">// Read until the &quot;Enter&quot; button is pressed</span></span><br><span class="line">    incomingString.trim(); <span class="comment">// Remove leading/trailing whitespaces</span></span><br><span class="line">    <span class="keyword">if</span> (incomingString == <span class="string">&quot;lift&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;Enter number of steps to move:&quot;</span>);</span><br><span class="line">      <span class="keyword">while</span> (!Serial.available()); <span class="comment">// Wait until a character is received</span></span><br><span class="line">      <span class="type">int</span> stepsToMove = Serial.parseInt(); <span class="comment">// Read an integer from the serial buffer</span></span><br><span class="line">      Serial.print(<span class="string">&quot;Moving down by &quot;</span>);</span><br><span class="line">      Serial.print(stepsToMove);</span><br><span class="line">      Serial.println(<span class="string">&quot; steps&quot;</span>);<span class="comment">///same as.print</span></span><br><span class="line">      stepper1.moveTo(stepsToMove); <span class="comment">// Set desired move: stepsToMove steps</span></span><br><span class="line">      stepper1.runToPosition(); <span class="comment">// Moves the motor to target position</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (incomingString == <span class="string">&quot;back&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;Moving back to original position&quot;</span>);</span><br><span class="line">      stepper1.moveTo(<span class="number">0</span>);</span><br><span class="line">      stepper1.runToPosition();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>The modified code first waits for the "lift" command to be received,
and then sends a prompt to enter the number of steps to move. It then
waits for an integer value to be received from the serial buffer using
the <code>Serial.parseInt()</code> function.</p>
<p>Once the number of steps is received, the motor is moved by the
specified number of steps, and the action is confirmed with a message
sent back to Python through the serial port.</p>
<h5
id="pcb板控制端给出串口由python接管调用功能">PCB板控制端，给出串口，由python接管调用功能</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ser = serial.Serial(<span class="string">&#x27;/dev/cu.usbserial-14210&#x27;</span>, <span class="number">9600</span>)  </span><br><span class="line"><span class="comment"># wait for the Arduino to reset  </span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">True</span>):  </span><br><span class="line">        inp = <span class="built_in">input</span>(<span class="string">&#x27;Choose the mode: &#x27;</span>)  </span><br><span class="line">        <span class="keyword">if</span> inp == <span class="string">&#x27;q&#x27;</span>:  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">        <span class="keyword">elif</span> inp == <span class="string">&#x27;SI_tunning&#x27;</span>:  </span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:  </span><br><span class="line">                command = <span class="built_in">input</span>(<span class="string">&#x27;Input command: &#x27;</span>)  </span><br><span class="line">                <span class="keyword">if</span> command ==<span class="string">&#x27;quit&#x27;</span>:  </span><br><span class="line">                    <span class="keyword">break</span> <span class="comment"># exit the SI mode loop and go back to the top-level loop  </span></span><br><span class="line">                ser.write(<span class="built_in">str</span>.encode(command))  </span><br><span class="line">                line = ser.readline().decode().rstrip()  </span><br><span class="line">                <span class="built_in">print</span>(line)  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">elif</span> inp ==<span class="string">&#x27;Si_etching&#x27;</span>:  </span><br><span class="line">            si_length = <span class="built_in">float</span>(<span class="built_in">input</span>(<span class="string">&#x27;Si_length unit (um) &#x27;</span>))  </span><br><span class="line">            etching_speed =<span class="built_in">float</span>(<span class="built_in">input</span>(<span class="string">&#x27;etching speed(um/min) &#x27;</span>))  </span><br><span class="line">            si_etching_control(si_length,etching_speed,<span class="number">12000</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># close the serial connection  </span></span><br><span class="line">ser.close()</span><br></pre></td></tr></table></figure>
<p>字符串变 bytes ### Error:</p>
<p>raise TypeError('unicode strings are not supported, please encode to
bytes: {!r}'.format(seq)) TypeError: unicode strings are not supported,
please encode to bytes: 'lift\n'</p>
<h3 id="solution">Solution</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">command = <span class="built_in">input</span>(<span class="string">&#x27;input command&#x27;</span>)  </span><br><span class="line">ser.write(<span class="built_in">str</span>.encode(command))  </span><br><span class="line">line = ser.readline()</span><br></pre></td></tr></table></figure>
<p>使用 Str.encode()方法 或者{}.format</p>
<h2 id="what-is-a-stepper-motor-and-how-it-works">What is a Stepper
Motor and How It Works?</h2>
<p>I will start with briefly explaining what is stepper motor and how it
works, as it will help us better understand everything else in this
tutorial. </p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/Inside-of-NEMA-17-Stepper-motor-How-It-Works.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Inside-of-NEMA-17-Stepper-motor-How-It-Works-1024x672.jpg?ezimgfmt=rs:639x419/rscb2/ng:webp/ngcb2"
alt="Inside of NEMA 17 Stepper motor - How It Works" /></a></p>
<p>A stepper motor is a unique type of brushless DC motor which position
can be precisely controlled even without any feedback.</p>
<p>The working principle of a stepper motor is based on magnetic fields.
It has two main components, a stator(定子) and a rotor（转子）. The
rotor is usually a permanent magnet and it’s surrounded by some coils on
the stator.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/Stepper-Motor-main-components-stator-and-a-rotor.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Stepper-Motor-main-components-stator-and-a-rotor-1024x630.png?ezimgfmt=rs:644x396/rscb2/ng:webp/ngcb2"
alt="Stepper Motor main components - stator and a rotor" /></a></p>
<p>When we energize or let current flow through the coils, particular
magnetic fields are generated in the stator that either attract or repel
the rotor. By activating the coils, step by step, one after another in a
particular order, we can achieve continues motion of rotor, but also, we
can make it stop at any position.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/Stepper-Motor-Working-Principle.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Stepper-Motor-Working-Principle-1024x323.png?ezimgfmt=rs:760x240/rscb2/ng:webp/ngcb2"
alt="Stepper-Motor-Working-Principle" /></a></p>
<p>So, that’s why these motors are called stepper motors, they move in
discrete steps. </p>
<p>By increasing the number of magnetic poles on the rotor, we can
increase the number of possible stopping positions, thus increase the
resolution or the precision of the motor. Please note that this is just
a basic explanation and you can find more details in my <a
target="_blank" rel="noopener" href="https://howtomechatronics.com/how-it-works/electrical-engineering/stepper-motor/">How
Stepper Motors Work</a> tutorial. </p>
<p>A typical stepper motor, a NEMA17 for example, has 50 stopping points
or steps on the rotor. On the other hand, the stator can have several
coils organized in two phases which provide four different magnetic
field orientations or positions.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/Stepper-motor-50-Steps-2-phases-and-4-different-magnetic-field-orientations-.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Stepper-motor-50-Steps-2-phases-and-4-different-magnetic-field-orientations-.png?ezimgfmt=rs:640x465/rscb2/ng:webp/ngcb2"
alt="Stepper motor - 50 Steps, 2 phases and 4 different magnetic field orientations" /></a></p>
<p>So, the 50 steps of the rotor multiplied by the 4 different magnetic
field orientations, make total of 200 steps for completing a full
rotation. Or if we divide 360 degrees by 200 steps, that’s a resolution
of 1.8 degrees per step.</p>
<p>I mentioned that the stator coils are organized in two phases, and we
can also notice that if we take a look at number of wires of a stepper
motor. It has 4 four wires, two for each phase. The four different
magnetic field orientations are possible as we can let current flow
through the phases in both directions.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/Current-flow-through-the-phases-stepper-motor-working-principle.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Current-flow-through-the-phases-stepper-motor-working-principle-1024x648.jpg?ezimgfmt=rs:661x418/rscb2/ng:webp/ngcb2"
alt="Current flow through the phases - stepper motor working principle" /></a></p>
<p>There also stepper motors with 5, 6 or even 8 wires, but they still
work on two phases or we control them with just four terminals.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/6-wire-and-8-wire-stepper-motor-connection-in-bi-polar-configuration.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/6-wire-and-8-wire-stepper-motor-connection-in-bi-polar-configuration.png?ezimgfmt=rs%3Adevice%2Frscb2-1"
alt="6-wire and 8-wire stepper motor connection in bi-polar configuration" /></a></p>
<p>The thing with them is that they can provide different performance
characteristics, like more torque or more speed, depending on how we
connect these wires on the four control terminals.</p>
<p>Nevertheless, with this brief explanation, now we understand that for
driving a stepper motor, we cannot just connect power to it as nothing
will happen. Instead, we have to energize the two motor phases in both
directions, and activate or send pulses to them in particular order, in
a timely sequence. So, that’s why we need drivers for controlling
stepper motors. </p>
<p>There are many types and sizes of drivers, corresponding to the many
types and sizes of stepper motors. However, the basic working principle
of all of them is that they have two H-Bridges that allow energizing the
motor phases in both directions.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/H-bridge-inside-a-stepper-motor-driver-how-it-works.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/H-bridge-inside-a-stepper-motor-driver-how-it-works-1024x843.png?ezimgfmt=rs:628x517/rscb2/ng:webp/ngcb2"
alt="H-bridge inside a stepper motor driver - how it works" /></a></p>
<p>Of course, they have many other functions like micro stepping,
current limiting, and so on that enable us to easily control the stepper
motors, which is the whole purpose of them.</p>
<h2
id="how-to-control-nema17-stepper-motor-with-arduino-and-a4988-stepper-driver">How
To Control NEMA17 Stepper Motor with Arduino and A4988 Stepper
Driver</h2>
<p>All right, now we can take a look at the first example for this
tutorial, how to control a NEMA 17 stepper motor with an A4988 stepper
driver. </p>
<p>All right, now we can take a look at the first example for this
tutorial, how to control a NEMA 17 stepper motor with an A4988 stepper
drive.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Stepper-motor-control-with-Arduino-and-A4988-stepper-driver-example-1024x576.jpg?ezimgfmt=rs:701x394/rscb2/ng:webp/ngcb2"
alt="Stepper motor control with Arduino and A4988 stepper driver - example" />
<figcaption aria-hidden="true">Stepper motor control with Arduino and
A4988 stepper driver - example</figcaption>
</figure>
<p>The NEMA17 is the most popular stepper motor among makers, as it
offers great performances and it’s affordable at the same time. It can
be also found in almost any desktop 3D printer and laser engraver. </p>
<p>Generally, the NEMA17 stepper motor has 200 steps, or 1.8 degrees per
step resolution, but there are also models with 400 steps and 0.9
degrees per step resolution. We should note here that the designation
NEMA17 actually describes just the size of the motor in terms of the
front faceplate size.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/NEMA-designation-meaning-for-stepper-motors-NEMA17-1024x581.jpg"
alt="NEMA designation meaning for stepper motors - NEMA17" />
<figcaption aria-hidden="true">NEMA designation meaning for stepper
motors - NEMA17</figcaption>
</figure>
<p>The number stands for the size of faceplate in inches when divided by
10, or in this case that would be 17 divided by 10 equals 1.7 inches
faceplate, or 2.3 inches faceplate in case of NEMA23.</p>
<p>So, the faceplate size is fixed, but the length of the NEMA17
steppers can vary from 20mm to 60mm, and with that the power requirement
of the motor also varies. The power requirement is usually defined by
how much current the motor is allowed to draw, and the range for these
NEMA17 steppers motors is from 0.3A up to 2.5A.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/NEMA17-stepper-motor-length-range-from-20mm-to-60mm-1024x576.jpg"
alt="NEMA17 stepper motor length range from 20mm to 60mm" />
<figcaption aria-hidden="true">NEMA17 stepper motor length range from
20mm to 60mm</figcaption>
</figure>
<p>Now, according to the current rating of the stepper motor, we need to
choose a suitable driver which can handle that amount of current. The
most popular driver controlling for NEMA17 stepper motors is the A4988
stepper motor driver.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/A4988-Stepper-Driver.jpg"
alt="A4988 Stepper Driver" />
<figcaption aria-hidden="true">A4988 Stepper Driver</figcaption>
</figure>
<p>The A4988 has a maximum current rating of 2A per coil, but that’s
actually a peak rating. It is recommended to keep the current to around
1A, but of course, it is also possible to go up to 2A of good cooling is
provided to the IC. </p>
<p>A great feature the A4988 stepper driver has, actually all other
drives have, is the current limiting. With this we can easily set how
much current the motor will draw no matter the motor rating. For
example, we can connect even a 2.5A rated stepper motor, but we will
limit the current of the driver to 1.5A. So, although the motor won’t
work at its maximum capacity, we would still be able to use it.</p>
<p>On the other hand, if the motor is rated lower than the set current
limit on the driver, the motor would overheat. Of course, it’s always
recommended to try to match the current rating of the motor with the
current rating of the driver.</p>
<h3 id="a4988-and-arduino-connection">A4988 and Arduino Connection</h3>
<p>All right, so now let’s see how to connect the A4988 driver with the
stepper motor and the Arduino controller.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/A4988-and-Arduino-Connection-Wiring-Diagram.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/A4988-and-Arduino-Connection-Wiring-Diagram-1024x501.png"
alt="A4988 and Arduino Connection - Wiring Diagram" /></a></p>
<p>At top right corner of the driver we have the VMOT and GND pins and
here we connect the power supply for the motor which can range 8 to 36V.
Here it is also recommended to use a decoupling capacitor across these
two pins in order to protect the board from voltage spikes. We should
use large electrolytic capacitor with at least 47uF capacity. </p>
<p>Next, are the four pins where we connect the stepper motor. One phase
of the motor goes on 1A and 1B pins, and the other phase on 2A and 2B
pins. </p>
<p>Sometimes, it can be a bit difficult to recognize which two wires of
the motor make a phase, but are several ways to identify them. The
simplest way is to rotate the shaft of the stepper motor by hand, and
then connect two wires to each other. If you connect two wires that make
a phase, the rotation of the shaft would be a bit more difficult.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/How-to-find-a-phase-in-a-stepper-motor-Easy-method-1024x576.jpg"
alt="How to find a phase in a stepper motor - Easy method" />
<figcaption aria-hidden="true">How to find a phase in a stepper motor -
Easy method</figcaption>
</figure>
<p>Another way is to use a multimeter and check for continuity between
the two wires. If you connect two wires that make a phase, you will have
a short circuit and the multimeter will start beeping.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/How-to-find-the-phase-of-a-stepper-motor-which-wires-make-a-phase.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/How-to-find-the-phase-of-a-stepper-motor-which-wires-make-a-phase-1024x576.jpg" /></a></p>
<p>Once we find a phase, we can connect it to any position of the two
positions on the driver, the order doesn’t matter. </p>
<p>Next, we have the IC or the logic power supply pins, VDD and GND,
which can be from 3V to 5V. On the other side we have the Step and the
Direction pins, which can be connected to any pin of the Arduino board.
With the Direction pin we select the rotation direction of the motor,
and with the Step pin we control to steps of the motor. With each pulse
we send to the Step pin, the motor will advance one step in the selected
direction. </p>
<p>Right above these pins, we have the Sleep and the Reset pins which
are used for, as their names suggest, putting the driver to sleep mode
or resetting it. We should note that both of these pins are active low.
The Sleep pin by default is HIGH state, but the RST pin is floating.
That means in order to have the driver enabled, the easiest way is to
just connect these two pins to each other, assuming we won’t use these
pins functions. </p>
<p>The Enable pin is also active low, so unless we pull it HIGH, the
driver will be enabled. </p>
<p>The next three pins, MS1, MS2 and MS3, are for selecting the step
resolution of the motor. We already said that the step resolution
depends on the construction of the motor which is usually 200 steps per
revolution for a NEMA 17 stepper motor. However, all stepper drivers
have this feature called microstepping which allows driving the motor at
higher resolutions. This is achieved by energizing the coils at an
intermediate current level, which produce intermediate step
locations.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/Steppers-control-with-Microstepping-intermediate-current-levels-on-the-motors-coils.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Steppers-control-with-Microstepping-intermediate-current-levels-on-the-motors-coils-1024x505.png" /></a></p>
<p>For example, if we select quarter-step resolution, the 200 steps of
the motor will become, 200 multiplied by 4 equals 800 microsteps per
revolution. The driver will use four different current levels on the
coils to achieve this. </p>
<p>The A4988 driver has a maximum resolution of 16 microsteps, which
would make a 200 steps NEMA17 motor has 3200 steps per revolution, or
that’s 0.1125 degrees per step. That’s really impressive precision and
that’s why these types of stepper motors and drivers are used in so many
applications. Actually, there are stepper drivers that have up 256
microsteps, or that’s a whopping 51200 steps per revolution, or 0.007
degrees per step.</p>
<p>Nevertheless, these three pins have pull-down resistors, so if we
leave them disconnected, the driver will work in full-step mode. For
selecting a different mircrostepping resolution we need to connect 5V to
the appropriate pins according to this table. </p>
<h3 id="a4988-current-limiting">A4988 Current Limiting</h3>
<p>All right, so now that we know how to connect the stepper motor and
the driver to the Arduino board, we can move on with explaining how to
program or code the Arduino for controlling the stepper. However, before
we do that, or before we power the motor, there is one more very
important thing that we need to do, and that’s to adjust the current
limit of the driver.</p>
<p>As we already explained, we need to adjust the current limit of the
driver to be lower than the current rating of the motor, or otherwise
the motor would overheat.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/Setting-the-A4988-current-limit-by-measuring-the-reference-voltage.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Setting-the-A4988-current-limit-by-measuring-the-reference-voltage-1024x576.jpg" /></a></p>
<p>There’s a small trimmer potentiometer on the A4988 driver though
which we can adjust the current limit. By rotating the potentiometer
clockwise, the current limit raises, and vice versa. There are two
methods which can be used for determining the actual value of the
current limit. </p>
<p>The first method involves measuring the reference voltage across the
potentiometer itself and GND. We can measure the reference voltage using
a multimeter, and use that value in the following formula to calculate
the current limit of the driver:</p>
<p><strong><em>Current Limit = Vref / (8 x Rcs)</em></strong></p>
<p>The Rcs is the current sense resistance or the values of the current
sensing resistors located right next to the chip. Depending on the
manufacturer, these values are usually 0.05, 0.1 or 0.2 ohms. So, we
need to take a closer look at the value of these resistors in order to
accurately calculate the current limit with this method. In my case,
these resistors were labeled R100, which meant 0.1ohms.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/A4988-stepper-driver-current-sensing-resistors-for-calculating-the-current-limit-using-the-voltage-reference.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/A4988-stepper-driver-current-sensing-resistors-for-calculating-the-current-limit-using-the-voltage-reference-1024x576.jpg" /></a></p>
<p>As an example, if we measure a reference voltage of 0.7V, and we have
0.1 ohms resistors, the current limit would be a 0.875A. Or if we want
to limit the current to, let’s say 1A, we should adjust the reference
voltage to 0.8V. </p>
<p>The second method for setting the current limit is by directly
measure the current through the coils. For that purpose, we need to
connect the stepper motor and the driver as explained previously. We can
skip the controller connection, but instead connect 5V to the Direction
and the Step pins so that the motor stays active and holds one position.
The MS pins should be left disconnected so the driver would work in
full-step mode. Then we can disconnect one line or coil from the motor,
and connect it in series with an ammeter. In this way, once we power the
driver with both the logic voltage, the 5V, and the power for the motor
12V in my case, we can read how much current is running through the
coil.</p>
<p><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Measuring-the-current-through-the-stepper-motor-coils-directly-using-an-ammeter-1024x576.jpg" /></p>
<p>Though, we should note here that when the driver works in full-step
mode, the current in the coils can reach only 70% of the actually
current limit. So, when using the driver in the other microstepping
modes, the reading from the ammeter should be multiplied by 1.3 in order
to get the actual value of the current limit of the driver. </p>
<p>I tried both methods for setting up the current limit of the driver
and they gave me approximately the same results.</p>
<h2 id="stepper-motors-and-arduino-example-codes">Stepper Motors and
Arduino – Example Codes</h2>
<p>Nevertheless, now we can move on with programming the Arduino, or
take a look at several example codes for controlling a stepper motor
with an Arduino board.</p>
<p><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Arduino-stepper-motor-control-with-A4988-driver-example-1024x576.jpg" /></p>
<p>Let’s start with a very basic example code of how to control a
stepper motor without using a library.</p>
<p><strong>Example code 1</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">/*   </span><br><span class="line"> *   Basic example code for controlling a stepper without library</span><br><span class="line"> *      </span><br><span class="line"> *   by Dejan, https://howtomechatronics.com</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">// defines pins</span><br><span class="line">#define stepPin 2</span><br><span class="line">#define dirPin 5 </span><br><span class="line"> </span><br><span class="line">void setup() &#123;</span><br><span class="line">  // Sets the two pins as Outputs</span><br><span class="line">  pinMode(stepPin,OUTPUT); </span><br><span class="line">  pinMode(dirPin,OUTPUT);</span><br><span class="line">&#125;</span><br><span class="line">void loop() &#123;</span><br><span class="line">  digitalWrite(dirPin,HIGH); // Enables the motor to move in a particular direction</span><br><span class="line">  // Makes 200 pulses for making one full cycle rotation</span><br><span class="line">  for(int x = 0; x &lt; 800; x++) &#123;</span><br><span class="line">    digitalWrite(stepPin,HIGH); </span><br><span class="line">    delayMicroseconds(700);    // by changing this time delay between the steps we can change the rotation speed</span><br><span class="line">    digitalWrite(stepPin,LOW); </span><br><span class="line">    delayMicroseconds(700); </span><br><span class="line">  &#125;</span><br><span class="line">  delay(1000); // One second delay</span><br><span class="line">  </span><br><span class="line">  digitalWrite(dirPin,LOW); //Changes the rotations direction</span><br><span class="line">  // Makes 400 pulses for making two full cycle rotation</span><br><span class="line">  for(int x = 0; x &lt; 1600; x++) &#123;</span><br><span class="line">    digitalWrite(stepPin,HIGH);</span><br><span class="line">    delayMicroseconds(500);</span><br><span class="line">    digitalWrite(stepPin,LOW);</span><br><span class="line">    delayMicroseconds(500);</span><br><span class="line">  &#125;</span><br><span class="line">  delay(1000);</span><br><span class="line">&#125;Code language: Arduino (arduino)</span><br></pre></td></tr></table></figure>
<p><strong>Code description:</strong></p>
<p>Here all we have to do is define to which pin number the STEP and DIR
pins are connected and define them as outputs. In the loop, first we set
the rotation direction of the motor by making the Direction pin status
HIGH. Then using a “for” loop we send 200 pulses to the STEP pin which
will make the motor rotate a full cycle, considering that it works in
full-step mode. The pulses are generated simply by toggling the state of
the STEP pin HIGH to LOW with some time delay between them. This time
delay actually defines the speed of rotation. If we lower it, the speed
of rotation will increase as the steps will occur faster, and vice
versa. </p>
<p>Then we change the rotation direction, and using another “for” loop
we send 400 pulses which would make to motor rotate two full cycles.
However, if we change the microstepping mode of the driver, let’s say so
a quarter-step, which would make the motor have 800 steps now, the first
loop will make the motor rotate only 90 degrees, and the second loop
only half rotation.</p>
<p><strong>Example code 2</strong></p>
<p>Here’s another simple example, controlling the stepper motor speed
using a potentiometer.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/Controlling-stepper-motor-speed-with-potentiometer-Wiring-diagram.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Controlling-stepper-motor-speed-with-potentiometer-Wiring-diagram-1024x522.png" /></a></p>
<p>For that purpose, just have to connect the potentiometer to the
Arduino and read its value using the analogRead() function.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">     Basic example code for controlling a stepper without library</span><br><span class="line"></span><br><span class="line">     by Dejan, https://howtomechatronics.com</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">// defines pins</span><br><span class="line">#define stepPin 2</span><br><span class="line">#define dirPin 5</span><br><span class="line"></span><br><span class="line">int customDelay, customDelayMapped;</span><br><span class="line"></span><br><span class="line">void setup() &#123;</span><br><span class="line">  // Sets the two pins as Outputs</span><br><span class="line">  pinMode(stepPin, OUTPUT);</span><br><span class="line">  pinMode(dirPin, OUTPUT);</span><br><span class="line">&#125;</span><br><span class="line">void loop() &#123;</span><br><span class="line">  speedControl();</span><br><span class="line">  // Makes pules with custom delay, depending on the Potentiometer, from which the speed of the motor depends</span><br><span class="line">  digitalWrite(stepPin, HIGH);</span><br><span class="line">  delayMicroseconds(customDelayMapped);</span><br><span class="line">  digitalWrite(stepPin, LOW);</span><br><span class="line">  delayMicroseconds(customDelayMapped);</span><br><span class="line">&#125;</span><br><span class="line">// Custom function for reading the potentiometer and mapping its value from 300 to 3000, suitable for the custom delay value in microseconds</span><br><span class="line">void speedControl() &#123;</span><br><span class="line">  customDelay = analogRead(A0); // Read the potentiometer value</span><br><span class="line">  customDelayMapped = map(customDelay, 0, 1023, 300, 3000); // Convert the analog input from 0 to 1024, to 300 to 3000</span><br><span class="line">&#125;Code language: Arduino (arduino)</span><br></pre></td></tr></table></figure>
<p><strong>Code description:</strong></p>
<p>We can then map or convert the potentiometer values which are from 0
to 1023, to values suitable for being a delay time in microseconds for
the Step pulses. I found the minimum value for the delay between steps
to be around 300 microseconds. By going lower that that the stepper
motor started skipping steps. </p>
<p>Overall, controlling stepper motors with this method is easy and it
works, but only if the required control is simple as shown in the
examples. In case we need more complex control, the best way is to use
an Arduino library.</p>
<h2
id="controlling-stepper-motors-with-arduino-and-the-accelstepper-library-examples">Controlling
Stepper Motors with Arduino and the AccelStepper Library – Examples</h2>
<p>The most popular library for controlling stepper motors with Arduino
is the <a
target="_blank" rel="noopener" href="https://www.airspayce.com/mikem/arduino/AccelStepper/">AccelStepper
library by Mike McCauley</a>. It’s an extremely versatile library
featuring speed, acceleration and deceleration control, setting target
positions, controlling multiple stepper motors simultaneously and so
on.</p>
<p>The library has a great documentation explaining how each function
work. I have already used this library for several of my Arduino
projects, for controlling the motion of my <a
target="_blank" rel="noopener" href="https://howtomechatronics.com/tutorials/arduino/diy-motorized-camera-slider-pan-tilt-head-project/">DIY
Camera Slider</a>, the <a
target="_blank" rel="noopener" href="https://howtomechatronics.com/projects/arduino-3d-wire-bending-machine/">3D
wire bending machine</a>, the <a
target="_blank" rel="noopener" href="https://howtomechatronics.com/projects/scara-robot-how-to-build-your-own-arduino-based-robot/">SCARA
robot arm</a> and few others. In case you are interested, there are
details and code explanations for each project on the website. </p>
<p>Now let’s take a look at few examples code using this library.</p>
<h3
id="example-code-stepper-motor-speed-control-using-a-potentiometer">Example
code – Stepper motor speed control using a potentiometer</h3>
<p>The first example will be controlling the speed of the motor using
the potentiometer.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/*   </span><br><span class="line"> *   Basic example code for controlling a stepper with the AccelStepper library</span><br><span class="line"> *      </span><br><span class="line"> *   by Dejan, https://howtomechatronics.com</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">#include &lt;AccelStepper.h&gt;</span><br><span class="line"></span><br><span class="line">// Define the stepper motor and the pins that is connected to</span><br><span class="line">AccelStepper stepper1(1, 2, 5); // (Type of driver: with 2 pins, STEP, DIR)</span><br><span class="line"></span><br><span class="line">void setup() &#123;</span><br><span class="line">  // Set maximum speed value for the stepper</span><br><span class="line">  stepper1.setMaxSpeed(1000);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop() &#123;</span><br><span class="line">  stepper1.setSpeed((analogRead(A0));</span><br><span class="line">  // Step the motor with a constant speed previously set by setSpeed();</span><br><span class="line">  stepper1.runSpeed();</span><br><span class="line">&#125;Code language: Arduino (arduino)</span><br></pre></td></tr></table></figure>
<p><strong>Code description:</strong></p>
<p>So, here first we need to include the AccelStepper library. Of
course, before we do that, we need to install the library and we can do
that from the Arduino IDE library manager. We just have to search
“AccelStepper” and the library will show up and we can install it. </p>
<p>Then, we need to create an instance of the AccelStepper class for our
motor. The first parameter here is the type of driver, in this case for
a driver with two control pins this value is 1, and the other two
parameters are the pin numbers to which our driver is connect to the
Arduino. If we have multiple stepper motors, we need to define each of
them like this, and we can name them however we want, in this case I
named my motor stepper1. </p>
<p>In the setup section we just have to set the maximum speed of the
motor which is defined as steps per second. This value can go up to
4000, but in the documentation of the library it is stated that speed
values of more than 1000 steps per seconds might be unreliable. </p>
<p>In the loop section, using the setSpeed() function we set the current
speed of the motor, and in this case that’s the analog input from the
potentiometer which is from 0 to 1023.</p>
<p>In order the motor to move and implement that constant speed, we need
to call the runSpeed() function each interval. A negative value here, or
simply including a minus sign before the value, would make the stepper
motor rotate in the opposite direction.</p>
<h3
id="example-code-controlling-two-stepper-motors-with-acceleration-and-deceleration">Example
code – Controlling two stepper motors with acceleration and
deceleration</h3>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Controlling-two-stepper-motors-with-acceleration-and-deceleration-example-1024x576.jpg"
alt="Controlling two stepper motors with acceleration and deceleration" />
<figcaption aria-hidden="true">Controlling two stepper motors with
acceleration and deceleration</figcaption>
</figure>
<p>Here’s another example of controlling two stepper motors with
implementing acceleration and deceleration using the AccelStepper
library.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">    Controlling two stepper with the AccelStepper library</span><br><span class="line"></span><br><span class="line">     by Dejan, https://howtomechatronics.com</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#include &lt;AccelStepper.h&gt;</span><br><span class="line"></span><br><span class="line">// Define the stepper motor and the pins that is connected to</span><br><span class="line">AccelStepper stepper1(1, 2, 5); // (Typeof driver: with 2 pins, STEP, DIR)</span><br><span class="line">AccelStepper stepper2(1, 3, 6);</span><br><span class="line"></span><br><span class="line">void setup() &#123;</span><br><span class="line"></span><br><span class="line">  stepper1.setMaxSpeed(1000); // Set maximum speed value for the stepper</span><br><span class="line">  stepper1.setAcceleration(500); // Set acceleration value for the stepper</span><br><span class="line">  stepper1.setCurrentPosition(0); // Set the current position to 0 steps</span><br><span class="line"></span><br><span class="line">  stepper2.setMaxSpeed(1000);</span><br><span class="line">  stepper2.setAcceleration(500);</span><br><span class="line">  stepper2.setCurrentPosition(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop() &#123;</span><br><span class="line"></span><br><span class="line">  stepper1.moveTo(800); // Set desired move: 800 steps (in quater-step resolution that&#x27;s one rotation)</span><br><span class="line">  stepper1.runToPosition(); // Moves the motor to target position w/ acceleration/ deceleration and it blocks until is in position</span><br><span class="line"></span><br><span class="line">  stepper2.moveTo(1600);</span><br><span class="line">  stepper2.runToPosition();</span><br><span class="line"></span><br><span class="line">  // Move back to position 0, using run() which is non-blocking - both motors will move at the same time</span><br><span class="line">  stepper1.moveTo(0);</span><br><span class="line">  stepper2.moveTo(0);</span><br><span class="line">  while (stepper1.currentPosition() != 0 || stepper2.currentPosition() != 0) &#123;</span><br><span class="line">    stepper1.run();  // Move or step the motor implementing accelerations and decelerations to achieve the target position. Non-blocking function</span><br><span class="line">    stepper2.run();</span><br><span class="line">    //</span><br><span class="line">    //</span><br><span class="line">  &#125;</span><br><span class="line">&#125;Code language: Arduino (arduino)</span><br></pre></td></tr></table></figure>
<p><strong>Code description:</strong></p>
<p>So, we need to define the two stepper motors, and in the setup, using
the setAcceleration() function set the acceleration value for the
motors. Using the setCurrentPosition() function we set the position of
the motors to be at 0 steps. </p>
<p>In the loop section, we start with the moveTo() function through
which we tell the motor to what position to go or how many steps it
should move. In case of quarter-step resolution, 800 steps would mean
one full rotation. Then, the runToPosition() function moves the motor to
that position while implementing acceleration and deceleration. However,
this is a blocking function, so the code execution will stay there until
the stepper motor reaches that position. </p>
<p>With the same method we move the second motor 1600 steps or two full
rotations with quarter-step resolution. </p>
<p>If we don’t want our code to be blocked until the motor reach the
target position, instead of using the runToPosition() function, we
should use the run() function. The run() also implements acceleration
and deceleration to achieve the target position, but it just makes one
step per call. Therefore, we need to call it as frequently as possible.
For that reason, here we put the run() functions for both motors in this
while loop, which is executed until both steppers reach position 0. We
previously set the two motors to go to position 0 with the moveTo()
functions. </p>
<p>We could also add more code in that “while” loop and do other stuff
too along running the motor. Actually, there are many methods of running
the motors and doing other stuff too. I recommend going through the
nicely described documentation of the library so you can understand how
each function works and implement them according to your needs.</p>
<h3
id="example-code-controlling-multiple-stepper-motors-with-accelstepper-library">Example
code – Controlling multiple stepper motors with AccelStepper
library</h3>
<p>I would like to show you one more example using the AccelStepper
library and that’s controlling multiple stepper motors in a coordinated
fashion. This means, we can set target positions for each stepper and
they can reach their positions all at the same time, no matter the
different distance they need to travel.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/Controlling-multiple-stepper-motors-with-AccelStepper-library.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Controlling-multiple-stepper-motors-with-AccelStepper-library-1024x576.jpg" /></a></p>
<p>This can be easily done using the MultiStepper class that comes with
the AccelStepper library.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">    Controlling multiple steppers with the AccelStepper and MultiStepper library</span><br><span class="line"></span><br><span class="line">     by Dejan, https://howtomechatronics.com</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">#include &lt;AccelStepper.h&gt;</span><br><span class="line">#include &lt;MultiStepper.h&gt;</span><br><span class="line"></span><br><span class="line">// Define the stepper motor and the pins that is connected to</span><br><span class="line">AccelStepper stepper1(1, 2, 5); // (Typeof driver: with 2 pins, STEP, DIR)</span><br><span class="line">AccelStepper stepper2(1, 3, 6);</span><br><span class="line">AccelStepper stepper3(1, 4, 7);</span><br><span class="line"></span><br><span class="line">MultiStepper steppersControl;  // Create instance of MultiStepper</span><br><span class="line"></span><br><span class="line">long gotoposition[3]; // An array to store the target positions for each stepper motor</span><br><span class="line"></span><br><span class="line">void setup() &#123;</span><br><span class="line"></span><br><span class="line">  stepper1.setMaxSpeed(1000); // Set maximum speed value for the stepper</span><br><span class="line">  stepper2.setMaxSpeed(1000);</span><br><span class="line">  stepper3.setMaxSpeed(1000);</span><br><span class="line"></span><br><span class="line">  // Adding the 3 steppers to the steppersControl instance for multi stepper control</span><br><span class="line">  steppersControl.addStepper(stepper1);</span><br><span class="line">  steppersControl.addStepper(stepper2);</span><br><span class="line">  steppersControl.addStepper(stepper3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop() &#123;</span><br><span class="line">  // Store the target positions in the &quot;gotopostion&quot; array</span><br><span class="line">  gotoposition[0] = 800;  // 800 steps - full rotation with quater-step resolution</span><br><span class="line">  gotoposition[1] = 1600;</span><br><span class="line">  gotoposition[2] = 3200;</span><br><span class="line"></span><br><span class="line">  steppersControl.moveTo(gotoposition); // Calculates the required speed for all motors</span><br><span class="line">  steppersControl.runSpeedToPosition(); // Blocks until all steppers are in position</span><br><span class="line"></span><br><span class="line">  delay(1000);</span><br><span class="line"></span><br><span class="line">  gotoposition[0] = 0;</span><br><span class="line">  gotoposition[1] = 0;</span><br><span class="line">  gotoposition[2] = 0;</span><br><span class="line"></span><br><span class="line">  steppersControl.moveTo(gotoposition);</span><br><span class="line">  steppersControl.runSpeedToPosition();</span><br><span class="line"></span><br><span class="line">  delay(1000);</span><br><span class="line">&#125;Code language: Arduino (arduino)</span><br></pre></td></tr></table></figure>
<p><strong>Code description:</strong></p>
<p>Here we also need to include the MultiStepper class, and create an
instance of it. Then we need to define an array, type “long”, which will
be used for storing the target positions for our motors. In the setup
section, we need to define the maximum speed values of the steppers and
add the steppers to the previously created MultiStepper instance, which
in my case I named it “steppersControl”. </p>
<p>In the loop section, we start by storing the target position values
in the array that we previously created. I set the first stepper to move
one rotation, the second, two rotations and the third one, three
rotations. Then we can assign this array to the moveTo() function which
will calculate the required speeds for all motors to arrive at those
positions at the same time. Then we just have to call the
runSpeedToPosition() function which will move the motors to their
position. Though we should note that this function blocks the code until
the steppers reach their target position. We could use the run()
function instead, if we don’t want to block the code. We should also
note that the MultiStepper class doesn’t support acceleration and
deceleration. </p>
<p>Nevertheless, if you want to learn more, from more advanced examples,
you can check my Arduino projects that I already mentioned, all the
details and the codes for them are on the website.</p>
<h2
id="cnc-shield-for-controlling-multiple-stepper-motors-for-any-arduino-project">CNC
shield for controlling multiple stepper motors for any Arduino
project</h2>
<p>Still taking about controlling multiple stepper motors, it’s worth
mentioning and taking a look at the Arduino CNC shield.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/CNC-Shield-for-controlling-multiple-stepper-motors-for-any-Arduino-project.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/CNC-Shield-for-controlling-multiple-stepper-motors-for-any-Arduino-project-1024x576.jpg" /></a></p>
<p>The main purpose of the Arduino CNC shield is for controlling 2 or
3-axis CNC machines, but it is actually a great option for controlling
any type of project where we need to control multiple stepper motors as
it is compact and provides easy connections for the drivers and the
motors. </p>
<p>This shield goes on top of an Arduino UNO board, and can control up
to 4 individual stepper motors, and have all the remaining Arduino pins
available for use. I used this combination of an Arduino UNO board and
the CNC shield for controlling my <a
target="_blank" rel="noopener" href="https://howtomechatronics.com/projects/scara-robot-how-to-build-your-own-arduino-based-robot/">4-axis
SCARA robot arm</a>.</p>
<p>I will update this section of the article, how to use the CNC shield
with Arduino with more details soon.</p>
<h2 id="drv8825-vs-a4988">DRV8825 vs A4988</h2>
<p>All right, so now let’s move on and see how we can control stepper
motors using the other driver that I mentioned at the beginning, the
DRV8825.</p>
<p>Actually, everything we explained so far about controlling stepper
motors with the A4988 stepper driver, applies for the DRV8825 as well.
The working principle, the connections and the coding are almost the
same for both of these drivers. The difference between them is in their
technical characteristics and now we will take a look at them and
compare them.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/DRV8825-vs-A4988-stepper-drivers.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/DRV8825-vs-A4988-stepper-drivers-1024x576.jpg"
alt="DRV8825 vs A4988" /></a></p>
<p>The DRV8825 is a stepper driver by Texas Instruments which can be
used as direct replacement for the Allegro A4988 driver as their
connections are the same. The three key differences between them are
that the DR8825 can deliver more current than the A4988 without
additional cooling (1.5A vs 1A), it has higher maximum supply voltage
(45V vs 35V), and it offers higher microstepping resolution (32 vs 16
microsteps). </p>
<p>Of course, they also have some other minor differences. For example,
the current limit potentiometer has a different location and the
relationship between the current limit setting and the reference pin
voltage is different. The DRV8825 doesn’t need logic power supply, and
the that pin location is used as FAULT output.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/DRV8825-vs-A4988-pinout.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/DRV8825-vs-A4988-pinout-1024x527.png" /></a></p>
<p>However, it is safe to connect the FAULT pin directly to 5V, so the
DRV8825 can be used as a direct replacement in systems designed for the
A4988 driver. </p>
<p>It’s worth noting though, that when replacing an A4988 driver with an
DRV8825 it is very important to make sure the orientation of the driver
is correct. I already mentioned, their potentiometers are at different
locations, on the A4988 it’s below the chip, and on the DRV8825 is above
the chip, and that can sometimes cause confusion and the driver can be
easily placed on the wrong side. </p>
<p>For setting the current limit, we can measure the reference voltage
with one probe on GND and the other on the potentiometer itself.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/Adjusting-the-current-limit-of-the-DRV8825-stepper-driver.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/Adjusting-the-current-limit-of-the-DRV8825-stepper-driver-1024x576.jpg"
alt="Adjusting the current limit of the DRV8825 stepper driver" /></a></p>
<p>The formula for calculating for the DRV8825 stepper drive is as
follow:</p>
<p><strong><em>Current limit = Vref x 2</em></strong></p>
<p>As for selecting the microstepping resolution, we can use the
following table.</p>
<p><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/DRV8825-Microstepping-select-table.jpg" /></p>
<p>Overall, the DRV8825 is a better stepper driver than the A4988, as it
offers higher current and voltage ratings, and higher microstepping
resolution which results in smoother and quieter operation of the
stepper motor.</p>
<h2 id="tmc2208-stepper-driver">TMC2208 Stepper Driver</h2>
<p>Speaking of smoother and quieter operation, let’s take a look at the
TMC2208 stepper driver. The TMC2208 chip is made by Trinamic, a Germany
based company specialized in motion control electronics. The TMC2208 is
a silent stepper motor driver which can be also used as a direct
replacement in systems designed for the A4988 or the DRV8825 drivers. It
is widely used in desktop 3D printers, laser engravers, scanners and so
on.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/TMC2208-vs-A4988-vs-DRV8825-stepper-motor-drivers.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/TMC2208-vs-A4988-vs-DRV8825-stepper-motor-drivers-1024x576.jpg"
alt="TMC2208 vs A4988 vs DRV8825 stepper motor drivers" /></a></p>
<p>What sets this driver apart from the two others is its integrated
interpolation unit which provides 256 subdivisions or microsteps. This
allows for perfect sinusoidal control which is generated internally
within the chip. This means that the driver will output 256 microsteps
to the stepper motor, no matter what microstep resolution we have
selected through the two MS pins, 2, 4, 8 or 16 microsteps. This
provides smoother operation and reduces the burden of the
microcontroller significantly.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/TMC2208-256-subdivisions-or-microsteps-with-integrated-interpolation-from-2-4-8-or-16-microsteps.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/TMC2208-256-subdivisions-or-microsteps-with-integrated-interpolation-from-2-4-8-or-16-microsteps-1024x576.jpg" /></a></p>
<p>This feature of the driver, in combination with the its noiseless
current control StealthChop2 technology, provide that ultra-silent
control of the stepper motors. Here’s a comparison of the noise levels
between the three drivers.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/TMC2208-vs-A4988-vs-DRV8825-Noise-Levels-Comparison.jpg"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/TMC2208-vs-A4988-vs-DRV8825-Noise-Levels-Comparison-1024x270.jpg"
alt="TMC2208 vs A4988 vs DRV8825 Noise Levels Comparison" /></a></p>
<p><strong>Stepper driver noise levels:</strong> A4988 around 65dB,
DRV8825 around 67dB and TMC2208 around 41dB.</p>
<p>The TMC2208 drives the stepper motors completely silently, which is
really impressive.</p>
<p>The current rating of the TMC2208 is slightly higher than the A4988
driver, or it’s 1.2A with 2A peak current. For setting the current limit
of the driver, again we can use the same method as explained for the
other drivers. We need to measure the reference voltage with one probe
on GND, and other on the whole right next to the Enable pin.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/TMC2208-current-limiting-by-measuring-the-reference-voltage.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/TMC2208-current-limiting-by-measuring-the-reference-voltage-1024x601.png"
alt="TMC2208 current limiting by measuring the reference voltage" /></a></p>
<p>The formula for calculating the current limit is as follow:</p>
<p><strong><em>Current limit = Vref x 0.71</em></strong></p>
<p>Although it can be used as direct replacement, the TMC2208 driver has
a slightly different pinout compared to the A4988 driver. Here we only
have two pins for selecting the microsteps resolution and for enabling
the driver we need to connect the Enable pin to GND.</p>
<p><a
target="_blank" rel="noopener" href="https://howtomechatronics.com/wp-content/uploads/2022/05/TMC2208-and-Arduino-Connection-Wiring-diagram-and-microstepping-table.png"><img
src="https://howtomechatronics.com/wp-content/uploads/2022/05/TMC2208-and-Arduino-Connection-Wiring-diagram-and-microstepping-table-1024x490.png"
alt="TMC2208 and Arduino Connection - Wiring diagram and microstepping table" /></a></p>
<p>In terms of coding, it’s the same as the other two drivers. </p>
<p>The TMC2208 driver also have some other, more advanced features
compared to the two other drivers, like for example, a simple-to-use
UART interface which provides controlling the driver with just a single
line, instead of the two Step and Dir pins. In addition to that I
provides more tuning and control options. </p>
<p>Overall, the TMC2208 is a better driver that the A4988 and the
DRV8825, but that’s normal as it comes with a higher price tag. Though,
if you don’t need these extra features and the noise levels doesn’t
concern you, are other two drivers are just great choice.</p>
<h3 id="步进驱动器的接线及设置">2、步进驱动器的接线及设置</h3>
<p>目前市场上有很多步进驱动器，各厂家的驱动器具有类似的接口，都有信号、电源、电机等接线端子；有输出电流及细分驱动设置的拨码开关。本节以雷赛科技（LeadShine）的DM542步进驱动器为例，介绍下步进驱动器的接线及设置。</p>
<p>DM542是雷赛公司推出的两相步进电机驱动器，采用脉冲方式进行控制，支持8档位电流及16档位细分驱动；输入电压范围：DC
20V<sub>50V，输出峰值电流范围：1.0</sub>4.2A；下面这张图是DM542的外观图：</p>
<figure>
<img
src="https://www.founderchip.com/zb_users/upload/2020/01/20200120165509_79003.png"
title="leisai_DM542.png" alt="leisai_DM542.png" />
<figcaption aria-hidden="true">leisai_DM542.png</figcaption>
</figure>
<p>从图片中可以看出，DM542步进驱动器包括控制信号端子、电源端子、电机接线端子、输出电流设置和细分驱动设置拨码开关等几部分组成。</p>
<p><strong>2.1、控制信号端子</strong></p>
<p>控制信号端子与PLC、单片机或其它控制器相连接，用来接收控制器发出的脉冲、方向及使能控制信号。</p>
<p>2.1.1、脉冲信号（Pulse）</p>
<p>脉冲信号有两个接线端子：PUL+和PUL-。"PUL+"连接脉冲信号正极，“PUL-”连接脉冲信号负极；脉冲信号以"PUL+"与"PUL-"的电压差来衡量；拨码开关SW13可设置脉冲的有效沿，默认（SW13=OFF）上升沿有效；</p>
<p>2.1.2、方向信号（Direction）</p>
<p>方向信号有两个接线端子：DIR+和DIR-。"DIR+"连接方向信号正极，"DIR-"连接方向信号负极；步进电机的初始运行方向与电机绕组的接线有关，任何一组绕组互换（比如：A+和A-互换）都能改变电机的初始运行方向；电机在运行过程中的方向改变可以通过方向信号来控制，为了保证步进电机可靠换向，方向信号应早于脉冲信号至少5us建立；</p>
<p>2.1.3、使能信号（Enable）</p>
<p>使能信号用于使能或禁止驱动器输出，有两个接线端子：ENA+和ENA-。"ENA+"连接使能信号正极，"ENA-"连接使能信号负极；当"ENA+"信号接通时，驱动器将切断步进电机各相电源而使其处于自由状态，该状态不响应脉冲信号；</p>
<p>注：脉冲信号、方向信号和使能信号输入电压值的大小可通过滑动开关来设置，有DC
5V和DC 24V两种选择，出厂默认DC 24V；</p>
<p>2.1.4、报警信号（Alarm）</p>
<p>驱动器故障信号输出，用于连接到PLC/控制器的输入通道。出厂默认正常情况下ALM和COM是导通状态，当驱动器报警时为截止状态；可通过拨码开关SW12设置；</p>
<p>2.1.4、抱闸信号（Brake）：步进电机的抱闸信号输入；</p>
<p>2.1.5、COM：报警信号和抱闸信号的公共端；</p>
<p><strong>2.2、电源接口</strong></p>
<p>电源接口包括2个接线端子：+Vdc、GND，其中：</p>
<p>+Vdc：直流电源正极，电压范围：+20V<sub>+50V，推荐+24V</sub>+48V；</p>
<p>GND：直流电源负极；</p>
<p><strong>2.3、电机接线端子</strong></p>
<p>电机接线端子包括：A+、A-、B+、B-，其中：</p>
<p>A+和A-是步进电机的A相绕组的两个接线柱；</p>
<p>B+和B-是步进电机的B相绕组的两个接线柱；</p>
<p>下面这张图是步进电机驱动器的接线图：</p>
<figure>
<img
src="https://www.founderchip.com/zb_users/upload/2020/01/20200120165509_64056.png"
title="步进驱动器接线图.png" alt="步进驱动器接线图.png" />
<figcaption aria-hidden="true">步进驱动器接线图.png</figcaption>
</figure>
<h3
id="步进电机的电流设置"><strong>2.4、步进电机的电流设置</strong></h3>
<p>DM542步进驱动器的中间有8个拨码开关（SW1<sub>SW8），其中SW1</sub>SW3用来设置工作电流（动态电流）；SW4用来设置静止电流（静态电流）；SW5~SW8是细分设置（将在第3小节详细介绍）；</p>
<p><strong>2.4.1、工作电流设置</strong></p>
<p>通过设置步进驱动器的电流输出拨码开关，可以改变驱动器的输出电流大小。DM542的SW1~SW3拨码开关设置如下图所示：</p>
<figure>
<img
src="https://www.founderchip.com/zb_users/upload/2020/01/20200120165509_42724.png"
title="sw1_sw3.png" alt="sw1_sw3.png" />
<figcaption aria-hidden="true">sw1_sw3.png</figcaption>
</figure>
<p>当步进驱动器设置的输出电流越大时，其连接的步进电机的输出力矩就越大。但是电流过大会导致电机和驱动器发热，严重时可能会损坏电机或驱动器。因此在设置步进驱动器的电流时建议遵循如下原则：</p>
<ul>
<li><p>四线电机：设置输出电流等于或略小于电机的额定电流；</p></li>
<li><p>六线电机高力矩模式：设置输出电流等于电机单极性接法额定电流的50%；</p></li>
<li><p>六线电机高速模式：设置输出电流等于电机单极性接法额定电流的100%；</p></li>
</ul>
<p>举个例子：假设要用DM542驱动雷赛42CM06步进电机，该电机的额定电流为2.5A，我们就采用输出均值电流2.36A的档位，设置SW1=OFF，SW2=ON，SW3=OFF；</p>
<p>另外要注意：步进电机的运动类型及停留时间的长短，都会影响其发热量。因此在实际使用中应视电机的发热情况适当调节输出电流的大小。原则上如果电机运行15~30分钟后如果表面温度低于40度，可适当增加电流设置值以增大输出扭矩；但如果温升太高（&gt;70度），则应降低电流的设置值；</p>
<p><strong>2.4.2、静止电流设置</strong></p>
<p>拨码开关SW4可用于设置步进电机在静止状态时驱动器的输出电流。默认情况下SW4=OFF，它表示驱动器在没有接收到脉冲0.4秒后，将输出电流改变为峰值电流的50%，这样可以降低驱动器和电机的发热；如果将SW4设置为ON，则电机在静止状态下，驱动器的输出电流为其峰值电流的90%；</p>
<h3 id="细分驱动设置">3、细分驱动设置</h3>
<p><strong>3.1、什么是细分驱动？</strong></p>
<p>步进电机在出厂时都标注了“固有步距角”。比如某电机的固有步距角为0.9度/1.8度，表示电机半步工作每次会转过0.9度，整步1.8度。在很多精密控制的场合，固有步距角不能满足控制精度的要求，人们希望能将一个固有步距角分很多步来走完。这种将固有步距角再分成很多步的驱动方法，称为"细分驱动"。能实现细分驱动的驱动器，称为"细分驱动器"。</p>
<p><strong>3.2、细分驱动的优点</strong></p>
<ul>
<li><p>细分驱动将固有步距角平均分成几份，减少了每步的步距角的大小，提高了步距均匀度，提高了控制精度；</p></li>
<li><p>低频振荡是步进电机的固有特性，细分驱动提高了电机的转动频率，可以降低电机的振动；</p></li>
<li><p>细分驱动可以有效减少转矩波动，提高输出转矩；</p></li>
</ul>
<p><strong>3.4、细分驱动的设置</strong></p>
<p>以DM542为例，该驱动器提供了四个拨码开关（SW5~SW8）用来设置细分驱动，如下图所示：</p>
<figure>
<img
src="https://www.founderchip.com/zb_users/upload/2020/01/20200120165509_65889.png"
title="sw5_sw8.png" alt="sw5_sw8.png" />
<figcaption aria-hidden="true">sw5_sw8.png</figcaption>
</figure>
<p>假设我们要把电机设置为3200步/转（即每转一圈需要3200个脉冲信号），则拨码开关设置如下：SW5=ON，SW6=ON，SW7=OFF，SW8=ON</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;AccelStepper.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define the stepper motor and the pins that is connected to</span></span><br><span class="line">AccelStepper <span class="title function_">stepper1</span><span class="params">(<span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>)</span>; <span class="comment">// (Typeof driver: with 2 pins, STEP, DIR)</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">  Serial.begin(<span class="number">9600</span>);</span><br><span class="line">  stepper1.setMaxSpeed(<span class="number">1000</span>); <span class="comment">// Set maximum speed value for the stepper</span></span><br><span class="line">  stepper1.setAcceleration(<span class="number">500</span>); <span class="comment">// Set acceleration value for the stepper</span></span><br><span class="line">  stepper1.setCurrentPosition(<span class="number">0</span>); <span class="comment">// Set the current position to 0 steps</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (Serial.available() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    String incomingString = Serial.readStringUntil(<span class="string">&#x27;\n&#x27;</span>); <span class="comment">// Read until the &quot;Enter&quot; button is pressed</span></span><br><span class="line">    incomingString.trim(); <span class="comment">// Remove leading/trailing whitespaces</span></span><br><span class="line">    <span class="keyword">if</span> (incomingString == <span class="string">&quot;lift&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;Moving down&quot;</span>);</span><br><span class="line">      stepper1.moveTo(<span class="number">15000</span>); <span class="comment">// Set desired move: 15000 steps</span></span><br><span class="line">      stepper1.runToPosition(); <span class="comment">// Moves the motor to target position</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (incomingString == <span class="string">&quot;back&quot;</span>) &#123;</span><br><span class="line">      Serial.println(<span class="string">&quot;Moving back to original position&quot;</span>);</span><br><span class="line">      stepper1.moveTo(<span class="number">0</span>);</span><br><span class="line">      stepper1.runToPosition();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Sure, here's an example Arduino sketch that reads a string from the
serial port and prints it to the Serial Monitor:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">arduinovoid setup() &#123;</span><br><span class="line">  // initialize serial communication at 9600 baud rate</span><br><span class="line">  Serial.begin(9600);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop() &#123;</span><br><span class="line">  if (Serial.available() &gt; 0) &#123;</span><br><span class="line">    // read the incoming string and store it in a variable</span><br><span class="line">    String incomingString = Serial.readString();</span><br><span class="line">    </span><br><span class="line">    // print the incoming string to the Serial Monitor</span><br><span class="line">    Serial.println(incomingString);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>This code listens for incoming data on the serial port, and when data
is available, it reads the string and stores it in a variable. It then
prints the incoming string to the Serial Monitor, allowing you to see
the text data that is being sent from your Python program or other
serial device. Note that <code>Serial.readString()</code> will read all
the characters in the serial buffer until it reaches a newline character
(<code>\n</code>) or the timeout period expires. So, make sure to send
your string with a newline character at the end or adjust the timeout
value, if necessary.</p>
<figure>
<img
src="https://chat.openai.com/_next/image?url=https%3A%2F%2Flh3.googleusercontent.com%2Fa%2FAEdFTp4JmUpX3g9eCc8g_mWlzi2zUqL2P0yb2DvzqoEBdQ%3Ds96-c&amp;w=64&amp;q=75"
alt="killer LB" />
<figcaption aria-hidden="true">killer LB</figcaption>
</figure>
<p>/* Controlling two stepper with the AccelStepper library by Dejan,
https://howtomechatronics.com */ #include &lt;AccelStepper.h&gt; //
Define the stepper motor and the pins that is connected to AccelStepper
stepper1(1, 3, 7); // (Typeof driver: with 2 pins, STEP, DIR) void
setup() { Serial.begin(9600); stepper1.setMaxSpeed(1000); // Set maximum
speed value for the stepper stepper1.setAcceleration(500); // Set
acceleration value for the stepper stepper1.setCurrentPosition(0); //
Set the current position to 0 steps } void loop() { if
(Serial.available()&gt;0){ String incomingString = Serial.readString();
if (incomingString == 'drop') { Serial.print("success run into drop
mode"); stepper1.moveTo(15000); // Set desired move: 800 steps (in
quater-step resolution that's one rotation) stepper1.runToPosition(); //
Moves the motor to target position w/ acceleration/ deceleration and it
blocks until is in position } //print the incoming string to the Serial
Monitor if (incomingString == 'back') { Serial.print("Backing into
original position "); stepper1.moveTo(0); stepper1.runToPosition(); } }
} check this code, I want to achieve the motor move down 15000 when I
type in "lift" and back to the original position when I type"back"</p>
<figure>
<img
src="https://chat.openai.com/_next/image?url=https%3A%2F%2Flh3.googleusercontent.com%2Fa%2FAEdFTp4JmUpX3g9eCc8g_mWlzi2zUqL2P0yb2DvzqoEBdQ%3Ds96-c&amp;w=64&amp;q=75"
alt="killer LB" />
<figcaption aria-hidden="true">killer LB</figcaption>
</figure>
<p>I want to achieve the motor move down 15000 when I type in "lift" and
back to the original position when I type"back"</p>
<p>I'm sorry, I made a mistake in my previous response. Here's the
corrected code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">arduino#include &lt;AccelStepper.h&gt;</span><br><span class="line"></span><br><span class="line">// Define the stepper motor and the pins that it is connected to</span><br><span class="line">AccelStepper stepper1(1, 3, 7); // (Type of driver: with 2 pins, STEP, DIR)</span><br><span class="line"></span><br><span class="line">void setup() &#123;</span><br><span class="line">  Serial.begin(9600);</span><br><span class="line">  stepper1.setMaxSpeed(1000); // Set maximum speed value for the stepper</span><br><span class="line">  stepper1.setAcceleration(500); // Set acceleration value for the stepper</span><br><span class="line">  stepper1.setCurrentPosition(0); // Set the current position to 0 steps</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop() &#123;</span><br><span class="line">  if (Serial.available() &gt; 0) &#123;</span><br><span class="line">    String incomingString = Serial.readString();</span><br><span class="line">    if (incomingString == &quot;lift&quot;) &#123;</span><br><span class="line">      Serial.println(&quot;Moving down 15000 steps&quot;);</span><br><span class="line">      stepper1.moveTo(15000); // Set desired move: 15000 steps</span><br><span class="line">      stepper1.runToPosition(); // Moves the motor to target position with acceleration/deceleration and blocks until it is in position</span><br><span class="line">    &#125;</span><br><span class="line">    else if (incomingString == &quot;back&quot;) &#123;</span><br><span class="line">      Serial.println(&quot;Moving back to original position&quot;);</span><br><span class="line">      stepper1.moveTo(0); // Set desired move: 0 steps (back to original position)</span><br><span class="line">      stepper1.runToPosition(); // Moves the motor to target position with acceleration/deceleration and blocks until it is in position</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>This code listens for incoming data on the serial port, and when data
is available, it reads the string and stores it in a variable. It then
checks if the incoming string is equal to "lift" or "back", and if it
is, it sets the desired move for the stepper motor and calls
<code>runToPosition()</code> to move the motor to the target position.
Note that the <code>moveTo()</code> function sets the absolute position
for the motor, so you don't need to keep track of the current position
manually. Also, make sure to enclose the string values in double quotes,
not single quotes.</p>
<p>If none of these suggestions work, please provide more information
about the issue you are facing, including any error messages or symptoms
you are observing.</p>
<figure>
<img
src="https://chat.openai.com/_next/image?url=https%3A%2F%2Flh3.googleusercontent.com%2Fa%2FAEdFTp4JmUpX3g9eCc8g_mWlzi2zUqL2P0yb2DvzqoEBdQ%3Ds96-c&amp;w=64&amp;q=75"
alt="killer LB" />
<figcaption aria-hidden="true">killer LB</figcaption>
</figure>
<p>Hardware work properly but When I type"lift" the code failed to make
a judge</p>
<p>It looks like there might be a problem with the <code>if</code>
statements in your <code>loop()</code> function. The <code>if</code>
statements are checking for a character instead of a string. Here's the
corrected code:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">scss#include &lt;AccelStepper.h&gt;</span><br><span class="line"></span><br><span class="line">// Define the stepper motor and the pins that is connected to</span><br><span class="line">AccelStepper stepper1(1, 3, 7); // (Typeof driver: with 2 pins, STEP, DIR)</span><br><span class="line"></span><br><span class="line">void setup() &#123;</span><br><span class="line">  Serial.begin(9600);</span><br><span class="line">  stepper1.setMaxSpeed(1000); // Set maximum speed value for the stepper</span><br><span class="line">  stepper1.setAcceleration(500); // Set acceleration value for the stepper</span><br><span class="line">  stepper1.setCurrentPosition(0); // Set the current position to 0 steps</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop() &#123;</span><br><span class="line">  if (Serial.available() &gt; 0) &#123;</span><br><span class="line">    String incomingString = Serial.readString();</span><br><span class="line">    if (incomingString == &quot;lift&quot;) &#123;</span><br><span class="line">      Serial.println(&quot;Moving down&quot;);</span><br><span class="line">      stepper1.moveTo(15000); // Set desired move: 15000 steps</span><br><span class="line">      stepper1.runToPosition(); // Moves the motor to target position</span><br><span class="line">    &#125; else if (incomingString == &quot;back&quot;) &#123;</span><br><span class="line">      Serial.println(&quot;Moving back to original position&quot;);</span><br><span class="line">      stepper1.moveTo(0);</span><br><span class="line">      stepper1.runToPosition();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>The corrected code checks for a string input using double quotes
(<code>"</code>) instead of a character input using single quotes
(<code>'</code>). The <code>Serial.println()</code> function is also
used instead of <code>Serial.print()</code> to add a line break after
the text message.</p>
<figure>
<img
src="https://chat.openai.com/_next/image?url=https%3A%2F%2Flh3.googleusercontent.com%2Fa%2FAEdFTp4JmUpX3g9eCc8g_mWlzi2zUqL2P0yb2DvzqoEBdQ%3Ds96-c&amp;w=64&amp;q=75"
alt="killer LB" />
<figcaption aria-hidden="true">killer LB</figcaption>
</figure>
<p>ser.write(b'100\n') what is b's function</p>
<p>In Python, the <code>b</code> prefix before a string literal creates
a bytes object rather than a regular string object. Bytes objects are
similar to string objects, but they represent a sequence of bytes rather
than a sequence of characters.</p>
<p>In the line <code>ser.write(b'100\n')</code>, the <code>b</code>
prefix is used to create a bytes object containing the string "100\n".
The <code>write()</code> method of a serial object expects a bytes
object as input, so the <code>b</code> prefix is necessary to convert
the string to bytes before it is sent over the serial port.</p>
<p>Without the <code>b</code> prefix, the <code>write()</code> method
would expect a regular string object, and a <code>TypeError</code> would
be raised when attempting to send the string over the serial port.</p>
<figure>
<img
src="https://chat.openai.com/_next/image?url=https%3A%2F%2Flh3.googleusercontent.com%2Fa%2FAEdFTp4JmUpX3g9eCc8g_mWlzi2zUqL2P0yb2DvzqoEBdQ%3Ds96-c&amp;w=64&amp;q=75"
alt="killer LB" />
<figcaption aria-hidden="true">killer LB</figcaption>
</figure>
<p><code>ser.read()</code> is a method in Python that reads a certain
number of bytes from a serial port and returns them as a bytes object.
It waits for incoming data to be available, then reads the specified
number of bytes or until a timeout occurs.</p>
<p>If no argument is provided, <code>ser.read()</code> will read a
single byte from the serial port. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pythonimport serial</span><br><span class="line"></span><br><span class="line">ser = serial.Serial(&#x27;/dev/ttyACM0&#x27;, 9600)</span><br><span class="line"></span><br><span class="line">data = ser.read() # Read a single byte from the serial port</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>If an argument <code>size</code> is provided,
<code>ser.read(size)</code> will read and return <code>size</code> bytes
from the serial port. For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pythonimport serial</span><br><span class="line"></span><br><span class="line">ser = serial.Serial(&#x27;/dev/ttyACM0&#x27;, 9600)</span><br><span class="line"></span><br><span class="line">data = ser.read(10) # Read 10 bytes from the serial port</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://chat.openai.com/_next/image?url=https%3A%2F%2Flh3.googleusercontent.com%2Fa%2FAEdFTp4JmUpX3g9eCc8g_mWlzi2zUqL2P0yb2DvzqoEBdQ%3Ds96-c&amp;w=64&amp;q=75"
alt="killer LB" />
<figcaption aria-hidden="true">killer LB</figcaption>
</figure>
<p>how to read serial message by line in python</p>
<p>To read serial messages by line in Python, you can use the
<code>readline()</code> method of a serial object. This method reads
from the serial port until it encounters a newline character
(<code>\n</code>) or carriage return (<code>\r</code>) and returns all
the characters it read up to that point.</p>
<p>Here's an example code snippet that demonstrates how to use
<code>readline()</code> to read serial messages by line:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pythonimport serial</span><br><span class="line"></span><br><span class="line">ser = serial.Serial(&#x27;/dev/ttyACM0&#x27;, 9600)</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    line = ser.readline()</span><br><span class="line">    print(line)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>In this example, the code creates a serial object for the port
<code>/dev/ttyACM0</code> with a baud rate of 9600. It then enters an
infinite loop and calls <code>readline()</code> on the serial object to
read one line of text from the serial port. The code then prints the
line to the console. The loop continues indefinitely, reading and
printing lines from the serial port as they are received.</p>
<p>Note that <code>readline()</code> will block until it receives a full
line of text, so the loop will pause until a full line is received. If
the sender is not sending complete lines of text, you may need to modify
the code to handle partial lines or use a different approach for reading
from the serial port.</p>
<h1 id="how-the-stepper-motor-work-步进电机工作原理">How the Stepper
Motor work 步进电机工作原理</h1>
<p>In this tutorial article you will learn how a stepper motor works. We
will cover the basic working principles of stepper motors, their driving
modes and the steppers types by construction. You can watch the
following video or read the written article.</p>
<p><img src="https://i.ytimg.com/vi/TWMai3oirnM/hqdefault.jpg" /></p>
<h2 id="working-principle">Working Principle</h2>
<p>Stepper motor is a brushless DC motor that rotates in steps. This is
very useful because it can be precisely positioned without any feedback
sensor, which represents an open-loop controller. The stepper motor
consists of a rotor that is generally a permanent magnet and it is
surrounded by the windings of the stator. As we activate the windings
step by step in a particular order and let a current flow through them
they will magnetize the stator and make electromagnetic poles
respectively that will cause propulsion to the motor. So that’ the basic
working principle of the stepper motors.</p>
<h3 id="working-principle-of-stepper-motor"><img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/Working-Principle02.jpg?ezimgfmt=rs:493x117/rscb2/ng:webp/ngcb2"
alt="Working-Principle of Stepper Motor" /></h3>
<h2 id="driving-modes">Driving Modes</h2>
<p>There are several different ways of driving the stepper motor. The
first one is the Wave Drive or Single-Coil Excitation. In this mode we
active just one coil at a time which means that for this example of
motor with 4 coils, the rotor will make full cycle in 4 steps.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/Wave-Drive-Mode.jpg?ezimgfmt=rs:493x203/rscb2/ng:webp/ngcb2"
alt="Wave-Drive Mode" />
<figcaption aria-hidden="true">Wave-Drive Mode</figcaption>
</figure>
<p>Next is the Full step drive mode which provides much higher torque
output because we always have 2 active coils at a given time. However
this doesn’t improve the resolution of the stepper and again the rotor
will make a full cycle in 4 steps.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/Full-Step-Drive-Mode.jpg?ezimgfmt=rs:493x203/rscb2/ng:webp/ngcb2"
alt="Full-Step-Drive-Mode" />
<figcaption aria-hidden="true">Full-Step-Drive-Mode</figcaption>
</figure>
<p>For increasing the resolution of the stepper we use the Half Step
Drive mode. This mode is actually a combination of the previous two
modes.</p>
<p>Here we have one active coil followed by 2 active coils and then
again one active coil followed by 2 active coils and so on. So with this
mode we get double the resolution with the same construction. Now the
rotor will make full cycle in 8 steps.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/Half-Step-Drive-Mode.jpg?ezimgfmt=rs:493x203/rscb2/ng:webp/ngcb2"
alt="Half-Step-Drive-Mode" />
<figcaption aria-hidden="true">Half-Step-Drive-Mode</figcaption>
</figure>
<p>However the most common method of <a
target="_blank" rel="noopener" href="https://howtomechatronics.com/tutorials/arduino/how-to-control-stepper-motor-with-a4988-driver-and-arduino/">controlling
stepper motors</a> nowadays is the Microstepping. In this mode we
provide variable controlled current to the coils in form of sin wave.
This will provide smooth motion of the rotor, decrease the stress of the
parts and increase the accuracy of the stepper motor.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/Microstepping.jpg?ezimgfmt=rs:493x203/rscb2/ng:webp/ngcb2"
alt="Microstepping" />
<figcaption aria-hidden="true">Microstepping</figcaption>
</figure>
<p>Another way of increasing the resolution of the stepper motor is by
increasing the numbers of the poles of the rotor and the numbers of the
pole of the stator.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/Incresing-Poles-Numbers0-300x300.jpg?ezimgfmt=rs:300x300/rscb2/ng:webp/ngcb2"
alt="Incresing-Poles-Numbers0" />
<figcaption aria-hidden="true">Incresing-Poles-Numbers0</figcaption>
</figure>
<h2 id="stepper-motor-types-by-construction">Stepper Motor Types by
Construction</h2>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/By-Construction.jpg?ezimgfmt=rs:493x161/rscb2/ng:webp/ngcb2"
alt="By-Construction" />
<figcaption aria-hidden="true">By-Construction</figcaption>
</figure>
<p>By construction there are 3 different types of stepper motors:
permanent magnet stepper, variable reluctance stepper and hybrid
synchronous stepper motor.</p>
<p>The <strong>Permanent Magnet</strong> stepper has a permanent magnet
rotor which is driven by the stators windings. They create opposite
polarity poles compared to the poles of the rotor which propels the
rotor.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/Stepper-Motor_PM-300x296.jpg?ezimgfmt=rs:300x296/rscb2/ng:webp/ngcb2"
alt="Stepper-Motor_PM" />
<figcaption aria-hidden="true">Stepper-Motor_PM</figcaption>
</figure>
<p>The next type, the <strong>Variable Reluctant</strong> stepper motor
uses a non-magnetizes soft iron rotor. The rotor has teeth that are
offset from the stator and as we active the windings in a particular
order the rotor moves respectively so that it has minimum gab between
the stator and the teeth of the rotor</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/Stepper-Motor-Variable-Reluctant01-300x296.jpg?ezimgfmt=rs:300x296/rscb2/ng:webp/ngcb2"
alt="Stepper-Motor-Variable-Reluctant01" />
<figcaption
aria-hidden="true">Stepper-Motor-Variable-Reluctant01</figcaption>
</figure>
<p>The <strong>Hybrid Synchronous</strong> motor is combinations of the
previous two steppers. It has permanent magnet toothed rotor and also a
toothed stator. The rotor has two sections, which are opposite in
polarity and their teeth are offset as shown here.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/Top-View-Rotor01-257x300.jpg?ezimgfmt=rs:257x300/rscb2/ng:webp/ngcb2"
alt="Top-View-Rotor01" />
<figcaption aria-hidden="true">Top-View-Rotor01</figcaption>
</figure>
<p>This is a front view of a commonly used hybrid stepper motor which
has 8 poles on the stator that are activated by 2 windings, A and B. So
if we activate the winding A, we will magnetize 4 poles of which two of
them will have South polarity and two of them North polarity.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/Hybrid-Stepper-Motor02-300x297.jpg?ezimgfmt=rs:300x297/rscb2/ng:webp/ngcb2"
alt="Hybrid-Stepper-Motor02" />
<figcaption aria-hidden="true">Hybrid-Stepper-Motor02</figcaption>
</figure>
<p>We can see that in such a way the rotors teeth are aligned with the
teeth of poles A and unaligned with the teeth of the poles B. That means
that in the next step when we turn off the A poles and activate the B
poles, the rotor will move counter clock wise and its teeth will align
with the teeth of the B poles.</p>
<figure>
<img
src="https://howtomechatronics.com/wp-content/uploads/2015/08/Hybrid-Stepper-Motor_Working-P.jpg?ezimgfmt=rs:493x114/rscb2/ng:webp/ngcb2"
alt="Hybrid-Stepper-Motor_Working-P" />
<figcaption
aria-hidden="true">Hybrid-Stepper-Motor_Working-P</figcaption>
</figure>
<p>If we keep activating the poles in a particular order the rotor will
move continuously. Here we can also use different driving modes like the
wave drive, full step drive, half step drive and microstepping for even
further increasing the resolution of the stepper motor</p>


  </article>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <div class="busuanzi center">
    page PV:&nbsp;<span id="busuanzi_value_page_pv"></span>&nbsp;・&nbsp;
    site PV:&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;・&nbsp;
    site UV:&nbsp;<span id="busuanzi_value_site_uv"></span>
  </div>


    
        <style>
        .vcard .vimg{left:0;}
        </style>
        <div id="vcomment" class="vcomment" style="padding:0 6% 0 7%;"></div>
        <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
        <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
        <script>
            var GUEST_INFO = ['nick','mail','link'];
            var guest_info = 'nick,mail,wesite'.split(',').filter(function(item){
                return GUEST_INFO.indexOf(item) > -1
            });
            var notify = 'true' == true;
            var verify = 'true' == true;
            var valine = new Valine();
            valine.init({
                el: '.vcomment',
                notify: notify,
                verify: verify,
                appId: "5ek9GU2ZQkuhuoyLBGXjUsAE-gzGzoHsz",
                appKey: "SfNLIu04NtDC8T2U4iP8CXHv",
                placeholder: "留下一句话呗，一起交流对世界的看法",
                pageSize:'5',
                avatar:'mm',
                lang:'zh-CN'
            })
        </script>
    





    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>
<div class="right-foot">
    <div class="firstrow">
        <a href="#top" target="_self">
        <svg class="i-caret-right" viewBox="0 0 32 32" width="24" height="24" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3">
            <path d="M10 30 L26 16 10 2 Z"></path>
        </svg>
        </a>
        ©Jakie Lian 2023-Futrue
    </div>
    <div class="secondrow">
        <a target="_blank" rel="noopener" href="http://home.ustc.edu.cn/~ustc_mitlb/#">
        Thinking keeps you alive
        </a>
    </div>
</div>
<div class="clearfix">
</div>
</footer>
  <script type="text/javascript">

// disqus scripts


// dropdown scripts
function $(s) {
    return document.querySelector(s)
  }

  function $$(s) {
    return document.querySelectorAll(s)
  }
  var dropDownElArr = $$('.dropdown')
  for (var i = 0; i < dropDownElArr.length; i += 1) {
    dropDownElArr[i].addEventListener('click', function(event) {
      var content = this.querySelector('.dropdown-content')
      event.stopPropagation()
      if (content.className.indexOf('open') < 0) {
        content.classList.add('open')
      } else {
        content.classList.remove('open')
      }
    })
  }
  document.body.addEventListener('click', function() {
    var dropDownContentElArr = $$('.dropdown-content')
    for (var i = 0; i < dropDownContentElArr.length; i += 1) {
      dropDownContentElArr[i].classList.remove('open')
    }
  })

  // smooth scroll
  $$('a[href^="#"]').forEach(e=>{
    e.addEventListener("click", function(e) {
      e.preventDefault();
      var t = this.getAttribute("href").substr(1);
      $(`[id='${decodeURIComponent(t)}']`).scrollIntoView({
        behavior: "smooth"
      }),
      t === "top" ? history.replaceState(null, null, " ") : history.pushState(null, null, `#${t}`)
    })
  })

// search
var searchEl = document.querySelector("#local-search-input")
if (searchEl) searchEl.addEventListener('keydown', function(e) {
  if (e.key === 'Enter') {
    var s = e.target.value
    window.open('//www.google.com/search?q=site:https://killerlb-ustc.github.io%20' + s, '_blank').focus()
  }
})

</script>

</body>
</html>
